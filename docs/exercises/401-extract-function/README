The function `filtered_data()` is doing too much. Separate the non-reactive code from the reactive code, by creating a new function that takes two arguments (cities and dates).